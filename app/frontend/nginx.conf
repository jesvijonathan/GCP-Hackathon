# Nginx configuration for a Vite/Vue.js Single Page Application (SPA)

server {
  # Listen on port 8080, as required by Google Cloud Run's environment.
  listen 8080;

  # The root directory where Nginx will look for files to serve.
  # This matches the directory where we copied our build files in the Dockerfile.
  root /usr/share/nginx/html;

  # Set the default file to serve.
  index index.html;

  # This is the crucial part for SPAs.
  # It tells Nginx how to handle requests.
  location / {
    # 1. try_files tries to find a file that matches the exact URL ($uri).
    # 2. If it can't find a file, it tries to see if the URL matches a directory ($uri/).
    # 3. If both fail, it serves the /index.html file as a fallback.
    # This allows your Vue router to handle the URL instead of Nginx trying to find a file that doesn't exist on the server.
    try_files $uri $uri/ /index.html;
  }

  # Optional: Improve performance by enabling Gzip compression for text-based assets.
  gzip on;
  gzip_vary on;
  gzip_proxied any;
  gzip_comp_level 6;
  gzip_types text/plain text/css application/json application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript;
}

